<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperAirDrop</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Ad Script Integration -->
    <script src='//libtl.com/sdk.js' data-zone='10008240' data-sdk='show_10008240'></script>
    <style>
        /* Global Styles */
        :root {
            --primary-color: #0088cc;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --bg-color: #ffffff;
            --text-color: #212529;
            --border-color: #dee2e6;
            --card-bg: #ffffff;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --card-bg: #1e1e1e;
            --shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 0 15px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }

        .btn {
            display: inline-block;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            padding: 8px 16px;
            font-size: 14px;
            line-height: 1.5;
            border-radius: 6px;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }

        .btn-primary {
            color: #fff;
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-success {
            color: #fff;
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-warning {
            color: #212529;
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }

        .btn-danger {
            color: #fff;
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-secondary {
            color: #fff;
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            display: block;
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--card-bg);
            background-clip: padding-box;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: 0;
            box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.25);
        }

        .text-center {
            text-align: center;
        }

        .d-none {
            display: none !important;
        }

        .d-flex {
            display: flex;
        }

        .justify-content-between {
            justify-content: space-between;
        }

        .align-items-center {
            align-items: center;
        }

        .mb-2 {
            margin-bottom: 8px;
        }

        .mb-3 {
            margin-bottom: 16px;
        }

        .mt-3 {
            margin-top: 16px;
        }

        .p-3 {
            padding: 16px;
        }

        .h4 {
            font-size: 1.5rem;
            font-weight: 500;
            line-height: 1.2;
        }

        .h5 {
            font-size: 1.25rem;
            font-weight: 500;
            line-height: 1.2;
        }

        .h6 {
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.2;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 500;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 6px;
        }

        .badge-success {
            color: #fff;
            background-color: var(--success-color);
        }

        .badge-warning {
            color: #212529;
            background-color: var(--warning-color);
        }

        .badge-danger {
            color: #fff;
            background-color: var(--danger-color);
        }

        .badge-secondary {
            color: #fff;
            background-color: var(--secondary-color);
        }

        .progress {
            display: flex;
            height: 8px;
            overflow: hidden;
            font-size: 12px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .progress-bar {
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            background-color: var(--primary-color);
            transition: width 0.6s ease;
        }

        .tab-content {
            margin-top: 16px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            padding-left: 0;
            margin-bottom: 0;
            list-style: none;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-tabs .nav-item {
            margin-bottom: -1px;
        }

        .nav-tabs .nav-link {
            display: block;
            padding: 8px 16px;
            border: 1px solid transparent;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            color: var(--text-color);
            text-decoration: none;
            cursor: pointer;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: var(--card-bg);
            border-color: var(--border-color) var(--border-color) var(--card-bg);
        }

        .table {
            width: 100%;
            margin-bottom: 16px;
            color: var(--text-color);
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            vertical-align: top;
            border-top: 1px solid var(--border-color);
        }

        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid var(--border-color);
        }

        .table tbody + tbody {
            border-top: 2px solid var(--border-color);
        }

        /* User Panel Styles */
        #user-panel {
            padding-bottom: 70px;
        }

        .user-header {
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
            border-radius: 0 0 20px 20px;
            margin-bottom: 16px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-details h2 {
            margin: 0;
            font-size: 18px;
        }

        .user-details p {
            margin: 0;
            opacity: 0.9;
        }

        .balance-card {
            background: white;
            color: #333;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .balance-card h3 {
            margin: 0 0 8px;
            font-size: 14px;
            opacity: 0.8;
        }

        .balance-card .amount {
            font-size: 28px;
            font-weight: bold;
            margin: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-card h4 {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .stat-card p {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
        }

        .chart-container {
            height: 200px;
            margin-bottom: 16px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--text-color);
        }

        .action-btn i {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .task-info h4 {
            margin: 0 0 4px;
            font-size: 16px;
        }

        .task-info p {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
        }

        .task-reward {
            font-weight: bold;
            color: var(--success-color);
        }

        .ad-progress {
            margin-bottom: 16px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .leaderboard-rank {
            width: 30px;
            text-align: center;
            font-weight: bold;
            margin-right: 12px;
        }

        .leaderboard-user {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--border-color);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .leaderboard-details h4 {
            margin: 0;
            font-size: 16px;
        }

        .leaderboard-details p {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
        }

        .leaderboard-score {
            font-weight: bold;
        }

        .referral-link {
            display: flex;
            margin-bottom: 16px;
        }

        .referral-link input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .referral-link .btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        .withdrawal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .withdrawal-info h4 {
            margin: 0 0 4px;
            font-size: 16px;
        }

        .withdrawal-info p {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            font-size: 12px;
            flex: 1;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* Admin Panel Styles */
        #admin-panel {
            min-height: 100vh;
            background-color: var(--bg-color);
        }

        .admin-header {
            background-color: var(--primary-color);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-nav {
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 0 16px;
            display: flex;
            overflow-x: auto;
        }

        .admin-nav-list {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .admin-nav-item {
            padding: 12px 16px;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            flex-shrink: 0;
        }

        .admin-nav-item.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .admin-content {
            padding: 16px;
            min-height: calc(100vh - 120px);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .admin-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .admin-card h3 {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .admin-card .value {
            font-size: 24px;
            font-weight: bold;
        }

        .data-table {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .table-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-container {
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .table-container table {
            width: 100%;
            min-width: 600px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }

        .page-item {
            margin: 0 4px;
        }

        .page-link {
            display: block;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-decoration: none;
            color: var(--text-color);
        }

        .page-item.active .page-link {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .form-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
        }

        .theme-toggle {
            position: fixed;
            top: 16px;
            right: 16px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            box-shadow: var(--shadow);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            opacity: 0.7;
        }

        .close:hover {
            opacity: 1;
        }

        /* Mining Graph Styles */
        .mining-graph {
            display: flex;
            align-items: flex-end;
            height: 150px;
            justify-content: space-between;
            padding: 0 10px;
        }

        .graph-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 12%;
        }

        .graph-bar-value {
            width: 100%;
            background: linear-gradient(to top, var(--primary-color), #0056b3);
            border-radius: 4px 4px 0 0;
            min-height: 10px;
            transition: height 0.5s ease;
        }

        .graph-bar-label {
            margin-top: 8px;
            font-size: 12px;
            text-align: center;
        }

        /* Admin Tab Styles */
        .admin-tab {
            display: none;
        }

        .admin-tab.active {
            display: block;
        }

        /* Ad Container Styles */
        .ad-container {
            width: 100%;
            margin: 20px 0;
            text-align: center;
        }

        .ad-unit {
            width: 100%;
            min-height: 100px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
        
        .w-100 {
            width: 100%;
        }
        
        .mr-2 {
            margin-right: 8px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .alert-info {
            background-color: rgba(23, 162, 184, 0.1);
            border: 1px solid rgba(23, 162, 184, 0.2);
            color: var(--info-color);
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="theme-toggle">
        <i id="theme-icon">🌙</i>
    </div>

    <!-- User Panel (Telegram Mini App) -->
    <div id="user-panel" class="d-none">
        <!-- Header -->
        <div class="user-header">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">
                    <i>👤</i>
                </div>
                <div class="user-details">
                    <h2 id="user-name">User Name</h2>
                    <p id="user-username">@username</p>
                </div>
            </div>
            <div class="balance-card">
                <h3>Main Balance</h3>
                <p class="amount" id="main-balance">0.00 AFN</p>
            </div>
        </div>

        <!-- Navigation Content -->
        <div class="container">
            <!-- Home Screen -->
            <div id="home-screen" class="tab-pane active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Today's Ads</h4>
                        <p id="today-ads">0/20</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Referrals</h4>
                        <p id="total-referrals">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Ads</h4>
                        <p id="total-ads">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Income</h4>
                        <p id="total-income">0.00 AFN</p>
                    </div>
                </div>

                <div class="card">
                    <h4 class="mb-3">Weekly Earnings</h4>
                    <div class="chart-container">
                        <div class="mining-graph" id="mining-graph">
                            <!-- Graph bars will be generated dynamically -->
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <a href="https://t.me/yourcommunity" class="action-btn" target="_blank">
                        <i>👥</i>
                        <span>Join Community</span>
                    </a>
                    <a href="https://x.com/youraccount" class="action-btn" target="_blank">
                        <i>🐦</i>
                        <span>Follow on X</span>
                    </a>
                </div>

                <!-- Ad Container -->
                <div class="ad-container">
                    <div id="monetag-ad-unit" class="ad-unit">
                        <!-- Monetag ads will load here -->
                        <p>Advertisement</p>
                    </div>
                </div>
            </div>

            <!-- Tasks Screen -->
            <div id="tasks-screen" class="tab-pane">
                <div class="card">
                    <h4 class="mb-3">Earning Wallet</h4>
                    <p class="mb-2">Current Balance: <strong id="earning-balance">0.00 AFN</strong></p>
                    <p class="mb-3" id="min-transfer-text">Minimum 10 AFN to transfer</p>
                    <button class="btn btn-primary w-100" id="transfer-btn" disabled>Transfer to Main Balance</button>
                </div>

                <div class="card">
                    <h4 class="mb-3">Daily Ad Progress</h4>
                    <div class="ad-progress">
                        <div class="progress-info">
                            <span>Progress</span>
                            <span id="ad-progress-text">0/20</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" id="ad-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" id="watch-ad-btn">Watch Ad (0.05 AFN)</button>
                </div>

                <div class="card">
                    <h4 class="mb-3">Bonus Tasks</h4>
                    <div id="bonus-tasks-list">
                        <!-- Tasks will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Leaderboard Screen -->
            <div id="leaderboard-screen" class="tab-pane">
                <ul class="nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-tab="referrers-tab">Top Referrers</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-tab="earners-tab">Top Earners</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div id="referrers-tab" class="tab-pane active">
                        <div id="referrers-list">
                            <div class="text-center p-3">Loading top referrers...</div>
                        </div>
                    </div>
                    <div id="earners-tab" class="tab-pane">
                        <div id="earners-list">
                            <div class="text-center p-3">Loading top earners...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Screen -->
            <div id="profile-screen" class="tab-pane">
                <div class="card">
                    <h4 class="mb-3">Invite Friends & Earn</h4>
                    <p class="mb-3">Invite your friends and earn 0.50 AFN for each successful referral!</p>
                    <div class="referral-link">
                        <input type="text" id="referral-link-input" class="form-control" readonly>
                        <button class="btn btn-primary" id="copy-link-btn">Copy</button>
                    </div>
                </div>

                <div class="card">
                    <h4 class="mb-3">Withdraw Funds</h4>
                    <p class="mb-3" id="withdrawal-condition">You are eligible for withdrawal.</p>
                    <button class="btn btn-primary w-100" id="withdraw-btn">Request Withdraw</button>
                </div>

                <div class="card">
                    <h4 class="mb-3">Withdrawal History</h4>
                    <div id="withdrawal-history">
                        <div class="text-center p-3">No withdrawal history</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" data-screen="home-screen">
                <i class="nav-icon">🏠</i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" data-screen="tasks-screen">
                <i class="nav-icon">📋</i>
                <span>Tasks</span>
            </a>
            <a href="#" class="nav-item" data-screen="leaderboard-screen">
                <i class="nav-icon">🏆</i>
                <span>Leaderboard</span>
            </a>
            <a href="#" class="nav-item" data-screen="profile-screen">
                <i class="nav-icon">👤</i>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Admin Panel (Browser View) -->
    <div id="admin-panel" class="d-none">
        <!-- Admin Login Screen -->
        <div id="admin-login" class="login-container">
            <div class="login-card">
                <h2 class="text-center mb-3">Admin Login</h2>
                <div class="form-group">
                    <label class="form-label" for="admin-email">Email</label>
                    <input type="email" class="form-control" id="admin-email" placeholder="admin@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label" for="admin-password">Password</label>
                    <input type="password" class="form-control" id="admin-password" placeholder="Enter password">
                </div>
                <button class="btn btn-primary w-100" id="admin-login-btn">Login</button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-dashboard" class="d-none">
            <div class="admin-header">
                <h2>SuperAirDrop Admin</h2>
                <button class="btn btn-secondary" id="admin-logout-btn">Logout</button>
            </div>

            <div class="admin-nav">
                <ul class="admin-nav-list">
                    <li class="admin-nav-item active" data-admin-tab="dashboard-tab">Dashboard</li>
                    <li class="admin-nav-item" data-admin-tab="users-tab">User Management</li>
                    <li class="admin-nav-item" data-admin-tab="tasks-tab">Task Management</li>
                    <li class="admin-nav-item" data-admin-tab="withdrawals-tab">Withdrawals</li>
                    <li class="admin-nav-item" data-admin-tab="config-tab">App Configuration</li>
                </ul>
            </div>

            <div class="admin-content">
                <!-- Dashboard Tab -->
                <div id="dashboard-tab" class="admin-tab active">
                    <div class="stats-cards">
                        <div class="admin-card">
                            <h3>Total Users</h3>
                            <p class="value" id="admin-total-users">0</p>
                        </div>
                        <div class="admin-card">
                            <h3>Total AFN Earned</h3>
                            <p class="value" id="admin-total-earned">0 AFN</p>
                        </div>
                        <div class="admin-card">
                            <h3>Pending Withdrawals</h3>
                            <p class="value" id="admin-pending-withdrawals">0</p>
                        </div>
                        <div class="admin-card">
                            <h3>Approved Withdrawals</h3>
                            <p class="value" id="admin-approved-withdrawals">0</p>
                        </div>
                    </div>
                </div>

                <!-- User Management Tab -->
                <div id="users-tab" class="admin-tab">
                    <div class="data-table">
                        <div class="table-header">
                            <h3>User Management</h3>
                            <div class="d-flex">
                                <input type="text" class="form-control" id="user-search" placeholder="Search users...">
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Username</th>
                                        <th>First Name</th>
                                        <th>Main Balance</th>
                                        <th>Earning Balance</th>
                                        <th>Referrals</th>
                                        <th>Join Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <tr>
                                        <td colspan="8" class="text-center">Loading users...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Task Management Tab -->
                <div id="tasks-tab" class="admin-tab">
                    <div class="form-card">
                        <h3 class="mb-3">Add New Task</h3>
                        <div class="form-group">
                            <label class="form-label" for="task-title">Task Title</label>
                            <input type="text" class="form-control" id="task-title" placeholder="Enter task title">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="task-description">Description</label>
                            <textarea class="form-control" id="task-description" placeholder="Enter task description"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="task-reward">Reward Amount (AFN)</label>
                            <input type="number" class="form-control" id="task-reward" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="task-url">URL/Instruction</label>
                            <input type="text" class="form-control" id="task-url" placeholder="Enter URL or instruction">
                        </div>
                        <button class="btn btn-primary" id="add-task-btn">Add Task</button>
                    </div>

                    <div class="data-table">
                        <div class="table-header">
                            <h3>Bonus Tasks</h3>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Description</th>
                                        <th>Reward</th>
                                        <th>URL</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="tasks-table-body">
                                    <tr>
                                        <td colspan="5" class="text-center">Loading tasks...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Withdrawals Tab -->
                <div id="withdrawals-tab" class="admin-tab">
                    <div class="data-table">
                        <div class="table-header">
                            <h3>Withdrawal Requests</h3>
                            <div class="d-flex">
                                <select class="form-control mr-2" id="withdrawal-status-filter">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Username</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Request Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="withdrawals-table-body">
                                    <tr>
                                        <td colspan="6" class="text-center">Loading withdrawal requests...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- App Configuration Tab -->
                <div id="config-tab" class="admin-tab">
                    <div class="form-card">
                        <h3 class="mb-3">App Configuration</h3>
                        <div class="alert alert-info">
                            <strong>Note:</strong> Changes here will affect all users.
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="daily-ads-limit">Daily Ads Limit</label>
                            <input type="number" class="form-control" id="daily-ads-limit" placeholder="20" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="ad-reward-amount">Ad Reward Amount (AFN)</label>
                            <input type="number" class="form-control" id="ad-reward-amount" placeholder="0.05" step="0.01" min="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="referral-reward">Referral Reward (AFN)</label>
                            <input type="number" class="form-control" id="referral-reward" placeholder="0.50" step="0.01" min="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="min-withdrawal">Minimum Withdrawal (AFN)</label>
                            <input type="number" class="form-control" id="min-withdrawal" placeholder="10.00" step="0.01" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="withdrawal-fee">Withdrawal Fee (%)</label>
                            <input type="number" class="form-control" id="withdrawal-fee" placeholder="5" min="0" max="100">
                        </div>
                        <button class="btn btn-primary" id="save-config-btn">Save Configuration</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawal-modal" class="modal d-none">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Request Withdrawal</h5>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="withdrawal-amount">Amount (AFN)</label>
                    <input type="number" class="form-control" id="withdrawal-amount" placeholder="Enter amount">
                </div>
                <div class="form-group">
                    <label class="form-label" for="withdrawal-method">Withdrawal Method</label>
                    <select class="form-control" id="withdrawal-method">
                        <option value="bank">Bank Transfer</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="paypal">PayPal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="withdrawal-details">Account Details</label>
                    <textarea class="form-control" id="withdrawal-details" placeholder="Enter your account details"></textarea>
                </div>
                <p id="withdrawal-info" class="text-center"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-withdrawal">Cancel</button>
                <button class="btn btn-primary" id="confirm-withdrawal">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
  apiKey: "AIzaSyDzSDrkS2PNR_fmMotz257Jr3AHCDs_Gqk",
  authDomain: "play2earn-hub-2d522.firebaseapp.com",
  projectId: "play2earn-hub-2d522",
  storageBucket: "play2earn-hub-2d522.firebasestorage.app",
  messagingSenderId: "766809606087",
  appId: "1:766809606087:web:2016a493a5d9edd268fbe2"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
    </script>

    <!-- Main Application Script -->
    <script>
        // Global variables
        let currentUser = null;
        let userData = null;
        let appConfig = {
            dailyAdsLimit: 20,
            adRewardAmount: 0.05,
            referralReward: 0.50,
            minWithdrawal: 10.00,
            withdrawalFee: 5
        };

        // DOM Elements
        const userPanel = document.getElementById('user-panel');
        const adminPanel = document.getElementById('admin-panel');
        const adminLogin = document.getElementById('admin-login');
        const adminDashboard = document.getElementById('admin-dashboard');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadAppConfiguration();
        });

        // Initialize the application based on platform
        function initializeApp() {
            // Check if we're in Telegram Web App
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                currentUser = Telegram.WebApp.initDataUnsafe.user;
                showUserPanel();
                initializeUserData();
            } else {
                // Show admin panel for browser
                showAdminPanel();
            }
        }

        // Show user panel (Telegram Mini App)
        function showUserPanel() {
            userPanel.classList.remove('d-none');
            adminPanel.classList.add('d-none');
            
            if (currentUser) {
                document.getElementById('user-name').textContent = 
                    currentUser.first_name || 'User';
                document.getElementById('user-username').textContent = 
                    currentUser.username ? `@${currentUser.username}` : 'Telegram User';
            }
        }

        // Show admin panel (Browser)
        function showAdminPanel() {
            userPanel.classList.add('d-none');
            adminPanel.classList.remove('d-none');
        }

        // Initialize user data from Firestore
        async function initializeUserData() {
            if (!currentUser) return;
            
            const userId = currentUser.id.toString();
            const userRef = db.collection('users').doc(userId);
            
            try {
                const doc = await userRef.get();
                
                if (doc.exists) {
                    userData = doc.data();
                } else {
                    // Create new user document
                    userData = {
                        userId: userId,
                        firstName: currentUser.first_name || '',
                        lastName: currentUser.last_name || '',
                        username: currentUser.username || '',
                        mainBalance: 0,
                        earningBalance: 0,
                        totalAds: 0,
                        todayAds: 0,
                        lastAdDate: null,
                        referrals: 0,
                        totalEarned: 0,
                        withdrawalHistory: [],
                        referralCode: generateReferralCode(),
                        joinDate: new Date().toISOString()
                    };
                    
                    await userRef.set(userData);
                }
                
                updateUI();
                loadLeaderboardData();
                loadWithdrawalHistory();
            } catch (error) {
                console.error('Error initializing user data:', error);
            }
        }

        // Generate a referral code for the user
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // Update UI with user data
        function updateUI() {
            if (!userData) return;
            
            // Update balances
            document.getElementById('main-balance').textContent = 
                userData.mainBalance.toFixed(2) + ' AFN';
            document.getElementById('earning-balance').textContent = 
                userData.earningBalance.toFixed(2) + ' AFN';
            
            // Update ad progress
            const todayAds = getTodayAdsCount();
            const progressPercent = (todayAds / appConfig.dailyAdsLimit) * 100;
            
            document.getElementById('today-ads').textContent = 
                `${todayAds}/${appConfig.dailyAdsLimit}`;
            document.getElementById('ad-progress-text').textContent = 
                `${todayAds}/${appConfig.dailyAdsLimit}`;
            document.getElementById('ad-progress-bar').style.width = `${progressPercent}%`;
            
            // Update other stats
            document.getElementById('total-referrals').textContent = userData.referrals || 0;
            document.getElementById('total-ads').textContent = userData.totalAds || 0;
            document.getElementById('total-income').textContent = 
                (userData.totalEarned || 0).toFixed(2) + ' AFN';
            
            // Update transfer button state
            const transferBtn = document.getElementById('transfer-btn');
            if (userData.earningBalance >= appConfig.minWithdrawal) {
                transferBtn.disabled = false;
                document.getElementById('min-transfer-text').textContent = 
                    `Minimum ${appConfig.minWithdrawal} AFN to transfer`;
            } else {
                transferBtn.disabled = true;
                document.getElementById('min-transfer-text').textContent = 
                    `Minimum ${appConfig.minWithdrawal} AFN required for transfer`;
            }
            
            // Update withdrawal condition
            const withdrawalCondition = document.getElementById('withdrawal-condition');
            if (userData.mainBalance >= appConfig.minWithdrawal) {
                withdrawalCondition.textContent = 
                    `You can withdraw minimum ${appConfig.minWithdrawal} AFN`;
                document.getElementById('withdraw-btn').disabled = false;
            } else {
                withdrawalCondition.textContent = 
                    `Minimum ${appConfig.minWithdrawal} AFN required for withdrawal`;
                document.getElementById('withdraw-btn').disabled = true;
            }
            
            // Update referral link
            document.getElementById('referral-link-input').value = 
                `https://t.me/YourBot?start=${userData.referralCode}`;
            
            // Update mining graph
            updateMiningGraph();
            
            // Load bonus tasks
            loadBonusTasks();
        }

        // Get today's ads count
        function getTodayAdsCount() {
            if (!userData.lastAdDate) return 0;
            
            const lastAdDate = new Date(userData.lastAdDate);
            const today = new Date();
            
            // Reset if it's a new day
            if (lastAdDate.toDateString() !== today.toDateString()) {
                return 0;
            }
            
            return userData.todayAds || 0;
        }

        // Update mining graph with weekly data
        function updateMiningGraph() {
            const graphContainer = document.getElementById('mining-graph');
            graphContainer.innerHTML = '';
            
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const maxHeight = 120;
            
            days.forEach(day => {
                const barContainer = document.createElement('div');
                barContainer.className = 'graph-bar';
                
                // Random height for demo (replace with actual data)
                const height = Math.floor(Math.random() * 100) + 20;
                
                const barValue = document.createElement('div');
                barValue.className = 'graph-bar-value';
                barValue.style.height = `${height}px`;
                
                const barLabel = document.createElement('div');
                barLabel.className = 'graph-bar-label';
                barLabel.textContent = day;
                
                barContainer.appendChild(barValue);
                barContainer.appendChild(barLabel);
                graphContainer.appendChild(barContainer);
            });
        }

        // Load bonus tasks from Firestore
        async function loadBonusTasks() {
            const tasksList = document.getElementById('bonus-tasks-list');
            
            try {
                const snapshot = await db.collection('bonusTasks')
                    .where('active', '==', true)
                    .get();
                
                tasksList.innerHTML = '';
                
                if (snapshot.empty) {
                    tasksList.innerHTML = '<div class="text-center p-3">No tasks available</div>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const task = doc.data();
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    taskItem.innerHTML = `
                        <div class="task-info">
                            <h4>${task.title}</h4>
                            <p>${task.description}</p>
                        </div>
                        <div class="task-reward">${task.reward} AFN</div>
                    `;
                    tasksList.appendChild(taskItem);
                });
            } catch (error) {
                console.error('Error loading bonus tasks:', error);
                tasksList.innerHTML = '<div class="text-center p-3">Error loading tasks</div>';
            }
        }

        // Load leaderboard data
        async function loadLeaderboardData() {
            await loadTopReferrers();
            await loadTopEarners();
        }

        // Load top referrers
        async function loadTopReferrers() {
            const referrersList = document.getElementById('referrers-list');
            
            try {
                const snapshot = await db.collection('users')
                    .orderBy('referrals', 'desc')
                    .limit(10)
                    .get();
                
                referrersList.innerHTML = '';
                
                if (snapshot.empty) {
                    referrersList.innerHTML = '<div class="text-center p-3">No referrers found</div>';
                    return;
                }
                
                let rank = 1;
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';
                    leaderboardItem.innerHTML = `
                        <div class="leaderboard-rank">${rank}</div>
                        <div class="leaderboard-user">
                            <div class="leaderboard-avatar">
                                <i>👤</i>
                            </div>
                            <div class="leaderboard-details">
                                <h4>${user.firstName || 'User'}</h4>
                                <p>${user.referrals || 0} referrals</p>
                            </div>
                        </div>
                        <div class="leaderboard-score">${user.referrals || 0}</div>
                    `;
                    referrersList.appendChild(leaderboardItem);
                    rank++;
                });
            } catch (error) {
                console.error('Error loading top referrers:', error);
                referrersList.innerHTML = '<div class="text-center p-3">Error loading referrers</div>';
            }
        }

        // Load top earners
        async function loadTopEarners() {
            const earnersList = document.getElementById('earners-list');
            
            try {
                const snapshot = await db.collection('users')
                    .orderBy('totalEarned', 'desc')
                    .limit(10)
                    .get();
                
                earnersList.innerHTML = '';
                
                if (snapshot.empty) {
                    earnersList.innerHTML = '<div class="text-center p-3">No earners found</div>';
                    return;
                }
                
                let rank = 1;
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';
                    leaderboardItem.innerHTML = `
                        <div class="leaderboard-rank">${rank}</div>
                        <div class="leaderboard-user">
                            <div class="leaderboard-avatar">
                                <i>👤</i>
                            </div>
                            <div class="leaderboard-details">
                                <h4>${user.firstName || 'User'}</h4>
                                <p>${(user.totalEarned || 0).toFixed(2)} AFN</p>
                            </div>
                        </div>
                        <div class="leaderboard-score">${(user.totalEarned || 0).toFixed(2)}</div>
                    `;
                    earnersList.appendChild(leaderboardItem);
                    rank++;
                });
            } catch (error) {
                console.error('Error loading top earners:', error);
                earnersList.innerHTML = '<div class="text-center p-3">Error loading earners</div>';
            }
        }

        // Load withdrawal history
        async function loadWithdrawalHistory() {
            const withdrawalHistory = document.getElementById('withdrawal-history');
            
            if (!userData || !userData.withdrawalHistory || userData.withdrawalHistory.length === 0) {
                withdrawalHistory.innerHTML = '<div class="text-center p-3">No withdrawal history</div>';
                return;
            }
            
            try {
                withdrawalHistory.innerHTML = '';
                
                userData.withdrawalHistory.forEach(withdrawal => {
                    const withdrawalItem = document.createElement('div');
                    withdrawalItem.className = 'withdrawal-item';
                    
                    const statusClass = {
                        'pending': 'badge-warning',
                        'approved': 'badge-success',
                        'rejected': 'badge-danger'
                    }[withdrawal.status] || 'badge-secondary';
                    
                    withdrawalItem.innerHTML = `
                        <div class="withdrawal-info">
                            <h4>${withdrawal.amount} AFN</h4>
                            <p>${new Date(withdrawal.date).toLocaleDateString()} - ${withdrawal.method}</p>
                        </div>
                        <span class="badge ${statusClass}">${withdrawal.status}</span>
                    `;
                    withdrawalHistory.appendChild(withdrawalItem);
                });
            } catch (error) {
                console.error('Error loading withdrawal history:', error);
                withdrawalHistory.innerHTML = '<div class="text-center p-3">Error loading history</div>';
            }
        }

        // Load app configuration from Firestore
        async function loadAppConfiguration() {
            try {
                const doc = await db.collection('appConfig').doc('main').get();
                
                if (doc.exists) {
                    const config = doc.data();
                    appConfig = { ...appConfig, ...config };
                    
                    // Update admin panel form if it exists
                    if (document.getElementById('daily-ads-limit')) {
                        document.getElementById('daily-ads-limit').value = appConfig.dailyAdsLimit;
                        document.getElementById('ad-reward-amount').value = appConfig.adRewardAmount;
                        document.getElementById('referral-reward').value = appConfig.referralReward;
                        document.getElementById('min-withdrawal').value = appConfig.minWithdrawal;
                        document.getElementById('withdrawal-fee').value = appConfig.withdrawalFee;
                    }
                }
            } catch (error) {
                console.error('Error loading app configuration:', error);
            }
        }

        // Save app configuration to Firestore
        async function saveAppConfiguration() {
            try {
                await db.collection('appConfig').doc('main').set(appConfig);
                alert('Configuration saved successfully!');
            } catch (error) {
                console.error('Error saving app configuration:', error);
                alert('Error saving configuration');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // User panel navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav item
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding screen
                    const screenId = this.getAttribute('data-screen');
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.classList.remove('active');
                    });
                    document.getElementById(screenId).classList.add('active');
                });
            });
            
            // Leaderboard tabs
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding tab
                    const tabId = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Copy referral link
            document.getElementById('copy-link-btn').addEventListener('click', function() {
                const referralInput = document.getElementById('referral-link-input');
                referralInput.select();
                document.execCommand('copy');
                alert('Referral link copied to clipboard!');
            });
            
            // Watch ad button
            document.getElementById('watch-ad-btn').addEventListener('click', watchAd);
            
            // Transfer button
            document.getElementById('transfer-btn').addEventListener('click', transferToMain);
            
            // Withdraw button
            document.getElementById('withdraw-btn').addEventListener('click', openWithdrawalModal);
            
            // Admin login
            document.getElementById('admin-login-btn').addEventListener('click', adminLoginHandler);
            
            // Admin logout
            document.getElementById('admin-logout-btn').addEventListener('click', adminLogoutHandler);
            
            // Admin navigation
            document.querySelectorAll('.admin-nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Update active nav item
                    document.querySelectorAll('.admin-nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding tab
                    const tabId = this.getAttribute('data-admin-tab');
                    document.querySelectorAll('.admin-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Save config button
            document.getElementById('save-config-btn').addEventListener('click', saveAppConfigHandler);
            
            // Withdrawal modal
            document.querySelector('.close').addEventListener('click', closeWithdrawalModal);
            document.getElementById('cancel-withdrawal').addEventListener('click', closeWithdrawalModal);
            document.getElementById('confirm-withdrawal').addEventListener('click', confirmWithdrawal);
            
            // Update withdrawal info when amount changes
            document.getElementById('withdrawal-amount').addEventListener('input', updateWithdrawalInfo);
        }

        // Toggle theme
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                body.removeAttribute('data-theme');
                themeIcon.textContent = '🌙';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Watch ad function
        async function watchAd() {
            if (!currentUser || !userData) return;
            
            const todayAds = getTodayAdsCount();
            
            // Check daily limit
            if (todayAds >= appConfig.dailyAdsLimit) {
                alert(`You have reached the daily limit of ${appConfig.dailyAdsLimit} ads.`);
                return;
            }
            
            // Show ad (simulated)
            alert('Please watch the ad to completion...');
            
            try {
                const userId = currentUser.id.toString();
                const userRef = db.collection('users').doc(userId);
                
                // Update user data
                const now = new Date();
                const updates = {
                    earningBalance: (userData.earningBalance || 0) + appConfig.adRewardAmount,
                    totalAds: (userData.totalAds || 0) + 1,
                    todayAds: todayAds + 1,
                    lastAdDate: now.toISOString(),
                    totalEarned: (userData.totalEarned || 0) + appConfig.adRewardAmount
                };
                
                await userRef.update(updates);
                
                // Update local user data
                userData = { ...userData, ...updates };
                
                // Update UI
                updateUI();
                
                alert(`You earned ${appConfig.adRewardAmount} AFN!`);
            } catch (error) {
                console.error('Error updating user data after watching ad:', error);
                alert('Error processing ad reward. Please try again.');
            }
        }

        // Transfer earning balance to main balance
        async function transferToMain() {
            if (!currentUser || !userData) return;
            
            if (userData.earningBalance < appConfig.minWithdrawal) {
                alert(`Minimum ${appConfig.minWithdrawal} AFN required for transfer.`);
                return;
            }
            
            try {
                const userId = currentUser.id.toString();
                const userRef = db.collection('users').doc(userId);
                
                await userRef.update({
                    mainBalance: (userData.mainBalance || 0) + userData.earningBalance,
                    earningBalance: 0
                });
                
                // Update local user data
                userData.mainBalance += userData.earningBalance;
                userData.earningBalance = 0;
                
                // Update UI
                updateUI();
                
                alert('Funds transferred to main balance successfully!');
            } catch (error) {
                console.error('Error transferring funds:', error);
                alert('Error transferring funds. Please try again.');
            }
        }

        // Open withdrawal modal
        function openWithdrawalModal() {
            if (!currentUser || !userData) return;
            
            if (userData.mainBalance < appConfig.minWithdrawal) {
                alert(`Minimum ${appConfig.minWithdrawal} AFN required for withdrawal.`);
                return;
            }
            
            document.getElementById('withdrawal-modal').classList.remove('d-none');
            document.getElementById('withdrawal-amount').value = userData.mainBalance.toFixed(2);
            updateWithdrawalInfo();
        }

        // Close withdrawal modal
        function closeWithdrawalModal() {
            document.getElementById('withdrawal-modal').classList.add('d-none');
        }

        // Update withdrawal info
        function updateWithdrawalInfo() {
            const amount = parseFloat(document.getElementById('withdrawal-amount').value) || 0;
            const fee = (amount * appConfig.withdrawalFee) / 100;
            const netAmount = amount - fee;
            
            document.getElementById('withdrawal-info').innerHTML = `
                <strong>Withdrawal Details:</strong><br>
                Amount: ${amount.toFixed(2)} AFN<br>
                Fee (${appConfig.withdrawalFee}%): ${fee.toFixed(2)} AFN<br>
                <strong>You'll receive: ${netAmount.toFixed(2)} AFN</strong>
            `;
        }

        // Confirm withdrawal
        async function confirmWithdrawal() {
            if (!currentUser || !userData) return;
            
            const amount = parseFloat(document.getElementById('withdrawal-amount').value) || 0;
            const method = document.getElementById('withdrawal-method').value;
            const details = document.getElementById('withdrawal-details').value;
            
            if (amount < appConfig.minWithdrawal) {
                alert(`Minimum withdrawal amount is ${appConfig.minWithdrawal} AFN.`);
                return;
            }
            
            if (amount > userData.mainBalance) {
                alert('Insufficient balance.');
                return;
            }
            
            if (!details.trim()) {
                alert('Please enter your account details.');
                return;
            }
            
            try {
                const userId = currentUser.id.toString();
                const userRef = db.collection('users').doc(userId);
                
                // Create withdrawal record
                const withdrawalId = Date.now().toString();
                const withdrawalData = {
                    id: withdrawalId,
                    userId: userId,
                    amount: amount,
                    method: method,
                    details: details,
                    status: 'pending',
                    date: new Date().toISOString(),
                    fee: (amount * appConfig.withdrawalFee) / 100
                };
                
                // Add to withdrawal history
                const updatedWithdrawalHistory = [
                    ...(userData.withdrawalHistory || []),
                    withdrawalData
                ];
                
                // Update user data
                await userRef.update({
                    mainBalance: userData.mainBalance - amount,
                    withdrawalHistory: updatedWithdrawalHistory
                });
                
                // Update local user data
                userData.mainBalance -= amount;
                userData.withdrawalHistory = updatedWithdrawalHistory;
                
                // Add to withdrawals collection for admin
                await db.collection('withdrawals').doc(withdrawalId).set(withdrawalData);
                
                // Close modal and update UI
                closeWithdrawalModal();
                updateUI();
                loadWithdrawalHistory();
                
                alert('Withdrawal request submitted successfully!');
            } catch (error) {
                console.error('Error processing withdrawal:', error);
                alert('Error processing withdrawal. Please try again.');
            }
        }

        // Admin login handler
        function adminLoginHandler() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            // Simple admin authentication (replace with secure authentication)
            if (email === 'admin@superairdrop.com' && password === 'admin123') {
                adminLogin.classList.add('d-none');
                adminDashboard.classList.remove('d-none');
                loadAdminData();
            } else {
                alert('Invalid admin credentials!');
            }
        }

        // Admin logout handler
        function adminLogoutHandler() {
            adminDashboard.classList.add('d-none');
            adminLogin.classList.remove('d-none');
            document.getElementById('admin-email').value = '';
            document.getElementById('admin-password').value = '';
        }

        // Load admin data
        async function loadAdminData() {
            await loadUsersTable();
            await loadTasksTable();
            await loadWithdrawalsTable();
            await loadAdminStats();
        }

        // Load users table
        async function loadUsersTable() {
            const tableBody = document.getElementById('users-table-body');
            
            try {
                const snapshot = await db.collection('users').limit(50).get();
                
                tableBody.innerHTML = '';
                
                if (snapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No users found</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.userId || 'N/A'}</td>
                        <td>${user.username || 'N/A'}</td>
                        <td>${user.firstName || 'N/A'}</td>
                        <td>${(user.mainBalance || 0).toFixed(2)} AFN</td>
                        <td>${(user.earningBalance || 0).toFixed(2)} AFN</td>
                        <td>${user.referrals || 0}</td>
                        <td>${new Date(user.joinDate).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-primary">Edit</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading users:', error);
                tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Error loading users</td></tr>';
            }
        }

        // Load tasks table
        async function loadTasksTable() {
            const tableBody = document.getElementById('tasks-table-body');
            
            try {
                const snapshot = await db.collection('bonusTasks').get();
                
                tableBody.innerHTML = '';
                
                if (snapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No tasks found</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const task = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${task.title}</td>
                        <td>${task.description}</td>
                        <td>${task.reward} AFN</td>
                        <td>${task.url || 'N/A'}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteTask('${doc.id}')">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading tasks:', error);
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Error loading tasks</td></tr>';
            }
        }

        // Load withdrawals table
        async function loadWithdrawalsTable() {
            const tableBody = document.getElementById('withdrawals-table-body');
            
            try {
                const snapshot = await db.collection('withdrawals')
                    .orderBy('date', 'desc')
                    .limit(50)
                    .get();
                
                tableBody.innerHTML = '';
                
                if (snapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No withdrawal requests</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const statusClass = {
                        'pending': 'badge-warning',
                        'approved': 'badge-success',
                        'rejected': 'badge-danger'
                    }[withdrawal.status] || 'badge-secondary';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${withdrawal.userId}</td>
                        <td>${withdrawal.username || 'N/A'}</td>
                        <td>${withdrawal.amount} AFN</td>
                        <td><span class="badge ${statusClass}">${withdrawal.status}</span></td>
                        <td>${new Date(withdrawal.date).toLocaleDateString()}</td>
                        <td>
                            ${withdrawal.status === 'pending' ? 
                                `<button class="btn btn-sm btn-success mr-2" onclick="updateWithdrawalStatus('${doc.id}', 'approved')">Approve</button>
                                 <button class="btn btn-sm btn-danger" onclick="updateWithdrawalStatus('${doc.id}', 'rejected')">Reject</button>` :
                                '<span>Processed</span>'
                            }
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading withdrawals:', error);
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">Error loading withdrawals</td></tr>';
            }
        }

        // Load admin stats
        async function loadAdminStats() {
            try {
                // Total users
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('admin-total-users').textContent = usersSnapshot.size;
                
                // Total AFN earned
                let totalEarned = 0;
                usersSnapshot.forEach(doc => {
                    totalEarned += doc.data().totalEarned || 0;
                });
                document.getElementById('admin-total-earned').textContent = totalEarned.toFixed(2) + ' AFN';
                
                // Pending withdrawals
                const pendingSnapshot = await db.collection('withdrawals')
                    .where('status', '==', 'pending')
                    .get();
                document.getElementById('admin-pending-withdrawals').textContent = pendingSnapshot.size;
                
                // Approved withdrawals
                const approvedSnapshot = await db.collection('withdrawals')
                    .where('status', '==', 'approved')
                    .get();
                document.getElementById('admin-approved-withdrawals').textContent = approvedSnapshot.size;
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        // Save app config handler
        function saveAppConfigHandler() {
            appConfig.dailyAdsLimit = parseInt(document.getElementById('daily-ads-limit').value) || 20;
            appConfig.adRewardAmount = parseFloat(document.getElementById('ad-reward-amount').value) || 0.05;
            appConfig.referralReward = parseFloat(document.getElementById('referral-reward').value) || 0.50;
            appConfig.minWithdrawal = parseFloat(document.getElementById('min-withdrawal').value) || 10.00;
            appConfig.withdrawalFee = parseFloat(document.getElementById('withdrawal-fee').value) || 5;
            
            saveAppConfiguration();
        }

        // Global functions for admin actions
        window.deleteTask = async function(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                try {
                    await db.collection('bonusTasks').doc(taskId).delete();
                    loadTasksTable();
                } catch (error) {
                    console.error('Error deleting task:', error);
                    alert('Error deleting task');
                }
            }
        };

        window.updateWithdrawalStatus = async function(withdrawalId, status) {
            try {
                await db.collection('withdrawals').doc(withdrawalId).update({
                    status: status
                });
                
                // If approved, update user's withdrawal history
                if (status === 'approved') {
                    const withdrawalDoc = await db.collection('withdrawals').doc(withdrawalId).get();
                    const withdrawal = withdrawalDoc.data();
                    
                    const userRef = db.collection('users').doc(withdrawal.userId);
                    const userDoc = await userRef.get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        const updatedWithdrawalHistory = userData.withdrawalHistory.map(w => 
                            w.id === withdrawalId ? { ...w, status: 'approved' } : w
                        );
                        
                        await userRef.update({
                            withdrawalHistory: updatedWithdrawalHistory
                        });
                    }
                }
                
                loadWithdrawalsTable();
                alert(`Withdrawal ${status} successfully!`);
            } catch (error) {
                console.error('Error updating withdrawal status:', error);
                alert('Error updating withdrawal status');
            }
        };

        // Add task handler
        document.getElementById('add-task-btn').addEventListener('click', async function() {
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const reward = parseFloat(document.getElementById('task-reward').value);
            const url = document.getElementById('task-url').value;
            
            if (!title || !description || !reward) {
                alert('Please fill in all required fields.');
                return;
            }
            
            try {
                await db.collection('bonusTasks').add({
                    title: title,
                    description: description,
                    reward: reward,
                    url: url,
                    active: true,
                    createdAt: new Date().toISOString()
                });
                
                // Clear form
                document.getElementById('task-title').value = '';
                document.getElementById('task-description').value = '';
                document.getElementById('task-reward').value = '';
                document.getElementById('task-url').value = '';
                
                // Reload tasks table
                loadTasksTable();
                
                alert('Task added successfully!');
            } catch (error) {
                console.error('Error adding task:', error);
                alert('Error adding task');
            }
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            themeIcon.textContent = '☀️';
        }
    </script>
</body>
</html>